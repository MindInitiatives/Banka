"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _connection = _interopRequireDefault(require("./connection.db"));

_connection["default"].query("DROP TABLE IF EXISTS users CASCADE;\n        CREATE TABLE users(\n            id SERIAL NOT NULL UNIQUE PRIMARY KEY,\n            firstName VARCHAR(128),\n            lastName VARCHAR(128),\n            email VARCHAR(128) UNIQUE NOT NULL,\n            password VARCHAR NOT NULL,\n            type VARCHAR(10) NOT NULL DEFAULT 'client',\n            isAdmin BOOLEAN NOT NULL DEFAULT false,\n            createdOn TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n        DROP TABLE IF EXISTS accounts CASCADE;\n        CREATE OR REPLACE FUNCTION acc_generator(OUT result bigint) AS $$\n        DECLARE\n            def_acc bigint := 2220220201;\n            last_id integer;\n        BEGIN\n            SELECT id FROM accounts ORDER BY createdOn DESC LIMIT 1 INTO last_id;\n            IF last_id IS NULL OR last_id = 0\n            THEN\n                result:= def_acc;\n            ELSE\n                result:= (def_acc + last_id + 100);\n            END IF;\n        END;\n        $$ LANGUAGE PLPGSQL;\n        CREATE TABLE accounts(\n            id SERIAL NOT NULL UNIQUE PRIMARY KEY,\n            accountNumber BIGINT UNIQUE DEFAULT acc_generator(),\n            owner INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n            type VARCHAR(10) NOT NULL,\n            status VARCHAR(10) DEFAULT 'dormant' ,\n            balance NUMERIC(10, 2) DEFAULT 0.00,\n            createdOn TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n        DROP TABLE IF EXISTS transactions CASCADE;\n        CREATE OR REPLACE FUNCTION change_account_balance() RETURNS trigger AS $$\n        BEGIN\n            UPDATE accounts SET balance=NEW.newbalance WHERE accountnumber=NEW.accountnumber;\n            RETURN NEW;\n        END;\n        $$ LANGUAGE PLPGSQL;\n        CREATE TABLE transactions(\n            id SERIAL NOT NULL UNIQUE PRIMARY KEY,\n            accountNumber BIGINT NOT NULL REFERENCES accounts(accountNumber) ON DELETE CASCADE,\n            cashier INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n            transactionType VARCHAR(10) NOT NULL,\n            amount NUMERIC(10, 2) DEFAULT 0.00,\n            oldBalance NUMERIC(10, 2) DEFAULT 0.00,\n            newBalance NUMERIC(10, 2) DEFAULT 0.00,\n            createdOn TIMESTAMP NOT NULL DEFAULT NOW()\n        );\n        CREATE TRIGGER new_transactions_entry\n        AFTER INSERT\n        ON transactions\n        FOR EACH ROW\n        EXECUTE PROCEDURE change_account_balance();\n    ");